<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Products | SmartStock</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:"Segoe UI",sans-serif;
  background:#020617;
  color:#e5e7eb;
}
header{
  padding:20px 40px;
  display:flex;
  justify-content:space-between;
  background:#0f172a;
}
button{
  padding:8px 18px;
  border-radius:999px;
  border:none;
  font-weight:bold;
  cursor:pointer;
}
.dashboard-btn{background:#38bdf8;color:#020617}
.logout-btn{background:#ef4444;color:white}

.container{padding:40px}
table{
  width:100%;
  border-collapse:collapse;
  background:rgba(255,255,255,.06);
}
th,td{
  padding:14px;
  text-align:center;
  border-bottom:1px solid rgba(255,255,255,.1);
}
.low{color:#f87171;font-weight:bold}
.ok{color:#4ade80;font-weight:bold}
.empty{opacity:.7;text-align:center;padding:30px}
</style>
</head>

<body>

<header>
  <h2 id="title">ðŸ“¦ Products</h2>
  <div>
    <button class="dashboard-btn" onclick="goDashboard()">Dashboard</button>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>
</header>

<div class="container">
<table>
<thead>
<tr>
  <th>Name</th>
  <th>Category</th>
  <th>Supplier</th>
  <th>Quantity</th>
  <th>Cost</th>
  <th>Value</th>
  <th>Status</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const BASE_URL = "http://127.0.0.1:5000";

  
  /* ðŸ“Œ READ FILTER */
  const params = new URLSearchParams(window.location.search);
  const filter = params.get("filter");

  if (filter === "low") {
    document.getElementById("title").innerText = "âš ï¸ Low Stock Products";
  }

  fetch(`${BASE_URL}/api/products`)
    .then(res => {
      if (!res.ok) throw new Error("Failed to load products");
      return res.json();
    })
    .then(products => {

      const table = document.getElementById("table");
      table.innerHTML = "";

      let displayProducts = products;

      if (filter === "low") {
        displayProducts = products.filter(p =>
          Number(p.quantity) < Number(p.lowStock)
        );
      }

      if (displayProducts.length === 0) {
        table.innerHTML =
          `<tr><td colspan="7" class="empty">No products found</td></tr>`;
        return;
      }

      displayProducts.forEach(p => {
        const qty = Number(p.quantity) || 0;
        const cost = Number(p.costPrice) || 0;
        const low = Number(p.lowStock) || 0;
        const value = qty * cost;

        table.innerHTML += `
          <tr>
            <td>${p.name}</td>
            <td>${p.category}</td>
            <td>${p.supplier}</td>
            <td>${qty}</td>
            <td>â‚¹${cost}</td>
            <td>â‚¹${value}</td>
            <td class="${qty < low ? 'low' : 'ok'}">
              ${qty < low ? "Low Stock" : "In Stock"}
            </td>
          </tr>
        `;
      });
    })
    .catch(err => {
      console.error(err);
      document.getElementById("table").innerHTML =
        `<tr><td colspan="7" class="empty">Unable to load products</td></tr>`;
    });

});

function goDashboard(){
  location.href = "/admin/dashboard";
}

function logout(){
  localStorage.clear();
  location.href = "/admin/login";
}
</script>

</body>
</html>
